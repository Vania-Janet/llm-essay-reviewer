
# Diccionario: nombre_archivo_ensayo -> nombre_archivo_anexo
MATCHES_SEGUROS_IA = {
    "Ensayo_Abril_Minerva_Estrada_Montaño_Las_Aulas_Invisibles_Neurodiversidad_y_la_Violencia_Epistémica_del_Sistema_Educativo.txt": "AnexoIA_Abril_Minerva_Justicia_Cognitiva_y_Neurodiversidad.txt",
    "Ensayo_Ana_Gabriela_González_Esparza_Miradas_al_Mañana.txt": "AnexoIA_Ana_Gabriela_Gonzalez_Esparza_Inegniera_Inversa.txt",
    "Ensayo_Andrea_Mata_Ramírez_Memoria_tecnológica_y_sociedad_el_legado_digital_de_la_ingeniería_humana.txt": "AnexoIA_Andrea_Mata_Ramírez_Memoria_tecnológica_y_sociedad.txt",
    "Ensayo_Angel_Abigail_Jaimes_Casales_Pantallas_que_Piensan_Inteligencia_Artificial,_Diseño_Responsable_y_Futuro_Sostenible.txt": "AnexoIA _Angel_Abigail_James_Casales_Pantallas_Que_Piensan.txt",
    "Ensayo_Arturo_Espinosa_Vargas_El_proyectil_que_nunca_podrá_ser_frenado;_un_artífice_de_su_propia_creación.txt": "AnexoIA_Arturo_Espinosa_Vargas_Uso_de_la_IA_generativa_en_el_ensayo.txt",
    "Ensayo_Carlos_Zepeda_Calalpa_Inteligencia_artificial_como_guía_y_no_como_sustituto.txt": "AnexoIA_Carlos_Zepeda_Proceso_Creativo,_Uso_de_la_IA.txt",
    "Ensayo_Chavero_Álvarez_Brian_Adair_Memoria_Tecnológica_La_Inteligencia_Artificial_como_Co-creadora_del_Futuro_Transmediático.txt": "AnexoIA_Chavero_Alvares_Brian_Memoria_Tecnológica_La_Inteligencia_Artificial_como_Co-creadora_del_Futuro_Transmediático.txt",
    "Ensayo_Cortés_Castro_Mariana_VIDA_EN_UN_SUEÑO_¿DIGITAL_O_¿HUMANO.txt": "AnexoIA_Cortés_Castro_Mariana_USO_RESPONSABLE_DE_HERRAMIENTAS_DE_IA_GENERATIVA.txt",
    "Ensayo_David_Lechuga_Sin_unicel_en_todos_los_televisores_de_Samsung_de_alta_gama_para_el_2026.txt": "AnexoIA_David_Lechuga_Proceso_de_producción_de_pulpa_moldeada.txt",
    "Ensayo_Diana_Gabriela_Mendoza_IA,_ENERGÍA_Y_JUSTICIA_AMBIENTAL.txt": "AnexoIA_Diana_Gabriela_Calderón_Mendoza_IA,_ENERGIA_Y_JUSTICIA_AMBIENTAL.txt",
    "Ensayo_Diego_Joshimar_Benitez_Espinosa_Innovación_inclusiva._La_accesibilidad_en_la_era_de_la_IA.txt": "AnexoIA_Diego_Jhosimar_Uso_Responsable_de_Herramientas_de_IA_Generativa.txt",
    "Ensayo_Eder_Bernardo_Sauz_Rangel_De_la_Obsolescencia_al_Reuso_Propuestas_para_una_Cultura_Tecnológica_Sostenible_en_el_Diseño_de_Pant.txt": "AnexoIA_Eder_Bernardo_De_La_Obsolencia_Al_Reuso.txt",
    "Ensayo_Emmanuel_Ciaro_La_paradoja_del_hombre_que_mira_una_máquina,_que_mira_a_un_hombre.txt": "AnexoIA_Emmanuel_Ciaro_Uso_de_NeuroX(IA).txt",
    "Ensayo_Fernando_Ordaz_Badager_La_inteligencia_artificial,_la_criminalidad_y_la_verdad_en_la_era_digital.txt": "AnexoIA_Fernando_Ordaz_La_inteligencia_artificial,_la_criminalidad_y_la_verdad_en_la_era_digital.txt",
    "Ensayo_Garduño_Rodríguez_Salvador_Arturo_MEMORIA_TECNOLÓGICA_¿ARCHIVO_FIEL_O_CÁRCEL_DE_LA_IMAGINACIÓN.txt": "AnexoIA_Garduño_Rodríguez_Salvador_Arturo_Memoria_tecnológica_¿Archivo_fiel_o_cárcel_de_la_imaginación.txt",
    "Ensayo_Gerardo_Enrique_Ramírez_Pérez_Un_camino_hacia_la_sustentabilidad.txt": "AnexoIA_Gerardo_Ramirez_Tecnología_inclusiva_y_accesible_en_la_era_de_la_inteligencia_artificial_un_camino_hacia_la_sustenta.txt",
    "Ensayo_Giovany_Ordóñez_Hernández_Eficiencia_con_justicia_IA_asequible_para_un_futuro_sustentable.txt": "AnexoIA_Giovany_Ordóñez_Hernández_Uso_de_Herramientas_de_IA_Generativa.txt",
    "Ensayo_Ian_El'hore_Quintana_¿Sueño_con_pantallas_¿O_con_pantallas_cumplo_mis_sueños.txt": "AnexoIA_Ian_Elhore_Sueño_Con_Pantallas.txt",
    "Ensayo_Imanol_Mendoza_Saenz_de_Buruaga_Trade-offs_en_la_era_de_la_IA_Lecciones_del_Pasado_y_Decisiones_para_el_Futuro.txt": "AnexoIA_Imanol_Mendoza_Proceso_creativo.txt",
    "Ensayo_Jorge_Gael_Santiago_Simón_Inclusión_de_otro_nivel_inteligencia_artificial_aplicada_a_la_accesibilidad.txt": "AnexoIA_Jorge_Gael_Santiago_Simon_Uso_de_IA_Inclusion_De_Otro_Nivel.txt",
    "Ensayo_Jorge_Rufino_de_León_Pérez_De_la_pantalla_al_intelecto.txt": "AnexoIA_Jorge_de_León_Inteligencia_De_La_Pantalla_Al_Intelecto.txt",
    "Ensayo_Joseph_Clemente_Resséndiz_López_El_patrón_de_la_inteligencia_Lo_que_no_podemos_dejar_de_construir.txt": "AnexoIA_Joseph_Clemente_Reseendiz_Declaración_de_Uso_de_Herramientas_de_IA_Generativa.txt",
    "Ensayo_Joshua_Vargas_La_Inteligencia_Artificial_el_espejo_incómodo_de_la_sociedad.txt": "AnexoIA_Joshua_Vargas_La_Inteligencia_Artificial_el_espejo_incómodo_de_la_sociedad.txt",
    "Ensayo_Karla_Giovana_García_Hernández_Humanos_en_modo_automático_la_memoria_tecnológica_en_tiempos_de_inteligencia_artificial.txt": "AnexoIA_Karla_Giovana_García_Hernández_Uso_responsable_de_herramientas_de_IA_generativa.txt",
    "Ensayo_Lalo_Orea_DEL_AURA_AL_ALGORITMO_LA_MEMORIA_TECNOLÓGICA_EN_LA_ERA_DE_LA_INTELIGENCIA_ARTIFICIAL.txt": "AnexoIA_Lalo_Orea_Relación_Del_Aura_Al_Algoritmo.txt",
    "Ensayo_Lalo_Orea_PATRONES_Y_EMOCIONES_HACIA_UN_HUMANISMO_TECNOLÓGICO_SOSTENIBLE.txt": "AnexoIA_Lalo_Orea_Patrones_Y_Emociones.txt",
    "Ensayo_Leonardo_García_Martínez_El_impacto_de_la_inteligencia_artificial_en_nuestra_sociedad_actual.txt": "AnexoIA_Leonardo_Garcia_El_impacto_de_la_inteligencia_artificial.txt",
    "Ensayo_Leyva_Angeles_Edson_Una_mirada_a_la_evolución_tecnológica_de_las_pantallas_y_su_impacto_en_la_cultura.txt": "AnexoIA_Leyva_Angeles_Edson_Una_mirada_a_la_evolución_tecnológica_de_las_pantallas_y_su_impacto_en_la_cultura.txt",
    "Ensayo_Luis_Héctor_Chávez_Mejía_Trascendiendo_la_discapacidad_visual_el_cómo_las_pantallas_y_la_IA_forjan_el_camino_a_la_era_de_la_t.txt": "AnexoIA_Luis_Hector_Chavez_Tecnologías_inclusivas_y_discapacidad_visual.txt",
    "Ensayo_Luis_Perez_LEX_IT_y_la_Decadencia_Programada_de_la_Memoria.txt": "AnexoIA_Luis_Perez_LEX_IT.txt",
    "Ensayo_Marcelo_Granados_Cruz_Inteligencia_Artificial_Inclusiva_en_la_Formación_del_Actuario.txt": "AnexoIA_Marcelo_Granados_Cruz_Declaración_sobre_el_Uso_de_Inteligencia_Artificial_Generativa.txt",
    "Ensayo_Mario_Ramirez_El_futuro_que_también_piensa_tecnología_sostenibilidad,_riesgo_y_justicia_en_la_era_digital.txt": "AnexoIA_Mario_Ramirez_El_Futuro_Que_Tambien_Piensa.txt",
    "Ensayo_Medina_Vallarta_Maximiliano_Tecnología_para_un_Futuro_Sostenible,_Inclusivo_y_Memorable.txt": "AnexoIA_Medina_Vallarta_Maximiliano_Tecnologia_Para_Un_Futuro_Sostenible.txt",
    "Ensayo_Miguel_Angel_Brito_Inteligencia_artificial_y_natural_Recuento_de_la_memoria_tecnológica_y_los_saberes_originarios.txt": "AnexoIA_Miguel_Agenl_Brito_Inteligencia_Artificial_Y_Natural_Recuento.txt",
    "Ensayo_Oscar_Josué_Sosa_Martínez_Los_períodos_pantallísticos_evolución_cultural_y_tecnológica_de_las_pantallas.txt": "AnexoIA_Oscar_Sosa_Los_Periodos_Pantallisticos_Evloucion.txt",
    "Ensayo_Paulina_Rosas_Chávez_Pantallas_con_memoria_lo_que_las_máquinas_recuerdan_de_nosotros.txt": "AnexoIA_Paulina_Rosas_Pantallas_con_memoria_lo_que_las_máquinas_recuerdan_de_nosotros.txt",
    "Ensayo_Rivera_Hernández_Emmanuel_Uso_crónico_de_la_IA.txt": "AnexoIA_Emmanuel_Rivera_Proceso_creativo_y_uso_de_IA.txt",
    "Ensayo_Roberto_Jhoshua_Alegre_Ventura_Tecnología_inclusiva_e_inteligencia_artificial_en_la_educación.txt": "AnexoIA_Roberto_Jhoshua_Alegre_Ventura_Tecnologia_Inclusiva.txt",
    "Ensayo_Rodrigo_Vázquez_Ramírez_Pantallas…_¿espejos_infinitos_o_ventanas_al_abismo.txt": "AnexoIA_Rodrigo_Vázquez_Ramírez_Pantallas…_¿espejos_infinitos_o_ventanas_al_abismo.txt",
    "Ensayo_Rojas_Hernández_Elí_Emmanuel_Los_sentimientos_y_su_impacto_en_la_IA.txt": "AnexoIA_Rojas_Emmanuel_Sentimientos.txt",
    "Ensayo_Ruben_Ramirez_Entre_el_algoritmo_y_el_juicio_riesgos_del_acceso_indiscriminado_a_la_inteligencia_artificial.txt": "AnexoIA_Rubén_Ramírez_Martínez_Uso_de_herramientas_de_IA.txt",
    "Ensayo_Said_Azar_Martinez_La_Pausa_Contemplativa_Redefiniendo_el_Diseño_Responsable_de_la_IA_más_allá_de_la_Sociedad_del_Rendi.txt": "AnexoIA_Said_Azar_Martinez_La_Pausa_Contemplativa_Redefiniendo.txt",
    "Ensayo_Santillán_Carraro_Ezequiel_Eduardo_Pantallas_Responsables.txt": "AnexoIA_Santillan_Carraro_Ezequiel_Eduardo_Herramientas_Inteligencia_Artificial.txt",
    "Ensayo_Saúl_García_López_La_inclusión_como_motor_de_la_innovación_tecnológica.txt": "AnexoIA_Saúl_García_López_Uso_responsable_de_herramientas_de_IA_generativa.txt",
    "Ensayo_Tomas_Soc_Paternalismo_Algorítmico_y_el_Futuro_del_Diseño_La_Recuperación_del_Control_en_la_Era_de_la_IA.txt": "AnexoIA_Tomas_Soc_Uso_de_Herramientas_de_IA_Generativa.txt",
    "Ensayo_Vania_Janet_Raya_Rios_Ver_con_las_manos,_oír_con_los_ojos_IA_accesible_en_pantallas_Samsung_para_inclusión_y_sostenibilida.txt": "AnexoIA_Vania_Janet_Raya_Ríos_Ver_con_las_manos,_oír_con_los_ojos_IA_accesible_en_pantallas_Samsung_para_inclusión_y_sostenibilida.txt",
    "Ensayo_Victor_Arieh_Sánchez_Santiago_El_mañana_en_nuestras_manos_sembrando_futuros_con_inteligencia_y_esperanza.txt": "AnexoIA_Victor_Arieh_Sánchez_Santiago_El_mañana_en_nuestras_manos_sembrando_futuros_con_inteligencia_y_esperanza.txt",
    "Ensayo_YAEL_JESÚS_SÁNCHEZ_JUÁREZ_LA_INTELIGENCIA_ARTIFICIAL_COMO_UNA_HERRAMIENTA_DE_ASISTENCIA,_QUE_NUNCA_PODRÁ_SUSTITUIR_LA_INTUICIÓ.txt": "AnexoIA_Yael_Jesus_Sanchez_Juarez_La_IA_Como_Una_herramienta.txt"
}

# Para búsqueda rápida: dado un nombre de archivo de ensayo, obtener el anexo
import unicodedata

def normalize_unicode(s: str) -> str:
    """Normaliza una cadena a forma NFC y estandariza apostrofes para comparación consistente."""
    # Primero normalizar Unicode
    s = unicodedata.normalize('NFC', s)
    # Reemplazar variantes de apóstrofe por apóstrofe simple
    apostrophe_variants = ['\u2019', '\u2018', '\u0027', '\u02BC']  # ', ', ', ʼ
    for variant in apostrophe_variants:
        s = s.replace(variant, "'")
    return s

# Pre-normalizar las claves del diccionario para búsqueda
MATCHES_NORMALIZADOS = {normalize_unicode(k): v for k, v in MATCHES_SEGUROS_IA.items()}

def obtener_anexo_ia(nombre_archivo_ensayo: str) -> str | None:
    """
    Obtiene el nombre del archivo de anexo correspondiente al ensayo.
    
    Args:
        nombre_archivo_ensayo: Nombre del archivo del ensayo (con o sin extensión)
    
    Returns:
        Nombre del archivo del anexo si existe match seguro, None si no existe
    """
    # Asegurar que tenga extensión .txt
    if not nombre_archivo_ensayo.endswith('.txt'):
        nombre_archivo_ensayo += '.txt'
    
    # Normalizar el nombre del archivo para comparación
    nombre_normalizado = normalize_unicode(nombre_archivo_ensayo)
    
    return MATCHES_NORMALIZADOS.get(nombre_normalizado)


def tiene_anexo_ia(nombre_archivo_ensayo: str) -> bool:
    """
    Verifica si un ensayo tiene anexo de IA con match seguro.
    
    Args:
        nombre_archivo_ensayo: Nombre del archivo del ensayo
    
    Returns:
        True si existe match seguro, False en caso contrario
    """
    return obtener_anexo_ia(nombre_archivo_ensayo) is not None


def cargar_texto_anexo(nombre_archivo_anexo: str, directorio: str = "data/anexos") -> str | None:
    """
    Carga el contenido del archivo de anexo.
    
    Args:
        nombre_archivo_anexo: Nombre del archivo del anexo
        directorio: Directorio donde se encuentra el anexo
    
    Returns:
        Contenido del anexo como string, None si no se puede leer
    """
    import os
    
    ruta_anexo = os.path.join(directorio, nombre_archivo_anexo)
    
    try:
        with open(ruta_anexo, 'r', encoding='utf-8') as f:
            return f.read()
    except FileNotFoundError:
        print(f"WARN: Anexo no encontrado: {ruta_anexo}")
        return None
    except Exception as e:
        print(f"ERROR: Al leer anexo {ruta_anexo}: {e}")
        return None


# Lista de ensayos con anexo para consulta rápida
ENSAYOS_CON_ANEXO = list(MATCHES_SEGUROS_IA.keys())
